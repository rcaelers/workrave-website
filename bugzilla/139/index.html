<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=generator content="Hugo 0.109.0"><meta name=robots content="noindex, nofollow"><meta name=description content="Workrave is a program that assists in the recovery and prevention of Repetitive Strain Injury (RSI). The program frequently alerts you to take micro-pauses, rest breaks and restricts you to your daily limit. The program runs on GNU/Linux and Microsoft Windows.
"><link rel="shortcut icon" type=image/x-icon href=/images/favicon.ico><link rel=stylesheet href=https://workrave.org/sass/main.min.ce4ba77d420210f043b2eafed49388defb4f40305be1d398a1ad593d5a932d05.css integrity="sha256-zkunfUICEPBDsur+1JOI3vtPQDBb4dOYoa1ZPVqTLQU=" media=screen><link rel=stylesheet href=https://workrave.org/css/main.min.163e0baf8d5e552480563d39ab81526b5107da66d4ad248880e87497fec53ea8.css integrity="sha256-Fj4Lr41eVSSAVj05q4FSa1EH2mbUrSSIgOh0l/7FPqg=" media=screen><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.7.1/css/all.css integrity=sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr crossorigin=anonymous><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Montserrat:300,400,500&display=swap"><link rel=canonical href=https://workrave.org/bugzilla/139/><title>&#183; Workrave</title></head><body class=bg-light><div class="page-content bg-white"><nav class="navbar fixed-top navbar-expand-lg navbar-light"><div class=container><a class=navbar-brand href=/><img src=/images/workrave-logo.svg alt=Workrave class=page-logo></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#mainNavBar aria-controls=mainNavBar aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=mainNavBar><ul class="navbar-nav ml-auto"><li class=nav-item><a class="nav-link text-uppercase" href=/about>About</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle text-uppercase" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>Get Help</a><div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdown><a class="dropdown-item text-uppercase" href=/faq/>FAQs</a>
<a class="dropdown-item text-uppercase" href=/docs/>Documentation</a>
<a class="dropdown-item text-uppercase" href=/support/>Support</a></div></li><li class=nav-item><a class="nav-link text-uppercase" href=/contribute>Contribute</a></li><li class=nav-item><a class="nav-link text-uppercase" href=/download/>Downloads</a></li><li class=nav-item><a class="nav-link text-uppercase" href=/blog/>Blog</a></li></ul></div></div></nav><div class="jumbotron jumbotron-fluid banner-style-small"></div><div class="container-lg mt-5 bugzilla" style=max-width:1280px><div class=row><div class="h3 col-md-12 bg-light font-weight-bold">Bug&nbsp;139 - Windows install fails: harpoon.dll</div></div><div class="row py-5"><div class=col-6><div class=row><div class="col-4 text-right font-weight-bold">Status:</div><div class=col-8>RESOLVED FIXED</div></div><div class=row><div class="col-4 text-right font-weight-bold">Component:</div><div class=col-8>Build-Env</div></div><div class=row><div class="col-4 text-right font-weight-bold">Version:</div><div class=col-8>1.0.0</div></div><div class=row><div class="col-4 text-right font-weight-bold">Hardware:</div><div class=col-8>PC Windows 2000</div></div><div class=row><div class="col-4 text-right font-weight-bold">Importance:</div><div class=col-8>P3 major</div></div><div class=row><div class="col-4 text-right font-weight-bold">Target Milestone:</div><div class=col-8>---</div></div><div class=row><div class="col-4 text-right font-weight-bold">Assignee:</div><div class=col-8>Raymond Penners</div></div><div class=row><div class="col-4 text-right font-weight-bold">URL:</div><div class=col-8></div></div><div class=row><div class="col-4 text-right font-weight-bold">Depends on:</div><div class=col-8></div></div><div class=row><div class="col-4 text-right font-weight-bold">Blocks:</div><div class=col-8><a href=https://workrave.org/bugzilla/175 style=text-decoration:line-through>175</a></div></div></div><div class=col-6><div class=row><div class="col-4 text-right font-weight-bold">Reported:</div><div class=col-8>Nov 4 2002 00:10:56 UTC</div></div><div class=row><div class="col-4 text-right font-weight-bold">by:</div><div class=col-8>Arnaud Gouder</div></div><div class=row><div class="col-4 text-right font-weight-bold">Modified:</div><div class=col-8>Aug 19 2003 16:33:35 UTC</div></div><div class=row><div class="col-4 text-right font-weight-bold">CC List:</div><div class=col-8>Kees-Jan Dijkzeul</div></div></div></div><div class="row pb-4"><div class=col-12><div class=card><h5 class="card-header p-1" id=history-header><button class="btn btn-light collapsed w-100 text-left" type=button data-toggle=collapse data-target=#history-content aria-expanded=false aria-controls=history-content>
<i class="fa fa-chevron-down pull-right"></i>&nbsp;history</button></h5><div class="collapse p-0" id=history-content aria-labelledby=history-header><div class="card-body p-0"><table class="table table-dark table-bordered mb-0"><thead><tr><th scope=col>Who</th><th scope=col>When</th><th scope=col>What</th><th scope=col>Removed</th><th scope=col>Added</th></tr></thead><tbody><tr><th scope=row rowspan=1>Raymond Penners</th><td rowspan=1>Nov 6 2002 11:34:48 UTC</td><td>assigned_to</td><td>Rob Caelers</td><td>Raymond Penners</td></tr><tr><th scope=row rowspan=1>Raymond Penners</th><td rowspan=1>Feb 13 2003 12:11:44 UTC</td><td>blocks</td><td></td><td>175</td></tr><tr><th scope=row rowspan=1>Raymond Penners</th><td rowspan=1>Mar 4 2003 05:47:19 UTC</td><td>status</td><td>NEW</td><td>ASSIGNED</td></tr><tr><th scope=row rowspan=2>Raymond Penners</th><td rowspan=2>Mar 4 2003 10:17:01 UTC</td><td>status</td><td>ASSIGNED</td><td>RESOLVED</td></tr><tr><td>resolution</td><td></td><td>FIXED</td></tr><tr><th scope=row rowspan=1>Raymond Penners</th><td rowspan=1>Aug 19 2003 02:10:27 UTC</td><td>cc</td><td></td><td>Kees-Jan Dijkzeul</td></tr><tr><th scope=row rowspan=2>Kees-Jan Dijkzeul</th><td rowspan=2>Aug 19 2003 03:36:11 UTC</td><td>status</td><td>RESOLVED</td><td>REOPENED</td></tr><tr><td>resolution</td><td>FIXED</td><td></td></tr><tr><th scope=row rowspan=2>Raymond Penners</th><td rowspan=2>Aug 19 2003 16:33:35 UTC</td><td>status</td><td>REOPENED</td><td>RESOLVED</td></tr><tr><td>resolution</td><td></td><td>FIXED</td></tr></tbody></table></div></div></div></div></div><div class="row pt-2"><div class=col-12><div class=card><div class="card-header h4 p-2"><div class=float-right>Description</div><div class=float-left>Arnaud Gouder&nbsp;&nbsp;Nov 4 2002 00:10:57 UTC</div></div><div class="card-body p-2"><pre style=white-space:pre-wrap>When I tried to install 1.0.0, I got an error that it could not write 
harpoon.dll. 

To a &#39;normal&#39; user, this is quite a major error, since it means he can&#39;t 
install wr.

I did not have WR running when I tried to install 1.0.0, so that&#39;s not what 
caused this. Then I tried to uninstall the previous version, and that helped, 
becuase now I could install 1.0.0 without any problems.</pre></div></div></div></div><div class="row pt-2"><div class=col-12><div class=card><div class="card-header h4 p-2"><div class=float-right>Comment 1</div><div class=float-left>Raymond Penners&nbsp;&nbsp;Nov 6 2002 11:34:48 UTC</div></div><div class="card-body p-2"><pre style=white-space:pre-wrap>So, you&#39;re indicating that installing the program on top of an already installed
Workrave does not work, whereas uninstallating the old version first works fine.
Did I understand you correctly?
</pre></div></div></div></div><div class="row pt-2"><div class=col-12><div class=card><div class="card-header h4 p-2"><div class=float-right>Comment 2</div><div class=float-left>Raymond Penners&nbsp;&nbsp;Mar 4 2003 05:47:19 UTC</div></div><div class="card-body p-2"><pre style=white-space:pre-wrap>Kees-Jan, opinions please?

The problem is, I can set configure the &#34;RestartReplace&#34; for harpoon.dll which
solves this bug.
However... see IMPORTANT below.

restartreplace
==============
This flag is generally useful when replacing core
system files. If the file existed beforehand and was found to be
locked resulting in Setup being unable to replace it, Setup will
register the file (either in WININIT.INI or by using MoveFileEx, for
Windows and Windows NT respectively) to be replaced the next time the
system is restarted. When this happens, the user will be prompted to
restart the computer at the end of the installation process.


IMPORTANT: The restartreplace flag will only successfully replace an
in-use file on Windows NT platforms if the user has administrative
privileges. If the user does not have administrative privileges, this
message will be displayed: &#34;RestartReplace failed: MoveFileEx failed;
code 5.&#34; Therefore, when using restartreplace it is highly recommended
that you have your installation require administrative privileges by
setting &#34;PrivilegesRequired=admin&#34; in the [Setup] section.
</pre></div></div></div></div><div class="row pt-2"><div class=col-12><div class=card><div class="card-header h4 p-2"><div class=float-right>Comment 3</div><div class=float-left>Kees-Jan Dijkzeul&nbsp;&nbsp;Mar 4 2003 06:21:27 UTC</div></div><div class="card-body p-2"><pre style=white-space:pre-wrap>I don&#39;t understand how uninstalling workrave first helped Arnaud.

I used to have the problem that, when uninstalling wr, harpoon.dll could not be
removed because there were still windows apps using it. Hence, a subsequent
install would fail, because it could not overwrite harpoon.dll, unless you do a
reboot in between.

My favourite workaround is to first uninstall, then rename harpoon.dll, and then
install. You&#39;ll be using a mix of old and new harpoon.dlls until the next
reboot. I guess setting RestartReplace property does something similar.

Anyway, I have not recently encountered this problem where I could not uninstall
workrave, hence I do not have this problem anymore (may be related to my
switching to XP?)

I&#39;m not very familiar with our current userbase. As far as I know, I was the
only user not having admin privileges. This has been fixed now, too. Hence,
turning on RestartReplace may be an easy solution to this problem (which doesn&#39;t
exist for me any more)

I&#39;m also not very familiar with windows setup procedures. Arnaud says
uninstalling first (I assume without rebooting) works for him. So then why does
the upgrade procedure fail? (assuming it does an implicit uninstall)

Maybe you can modify the installation procedure to include my workaround
renaming harpoon.dll and then requesting a reboot. This would be like
implementing RestartReplace yourself, except that you probably don&#39;t have the
opportunity to remove the renamed harpoon.dll. Then again, I don&#39;t think that hurts.

I&#39;m not very fond of programs requiring a reboot as part of the installation
process. Especially in case of workrave, since I always tend to upgrade in the
middle of my work (one of the privileges of alpha testing :-). But then again,
if this is the safe way to go, it might be worth while. I can always say &#34;no&#34;.

Does any of this make any sense?</pre></div></div></div></div><div class="row pt-2"><div class=col-12><div class=card><div class="card-header h4 p-2"><div class=float-right>Comment 4</div><div class=float-left>Raymond Penners&nbsp;&nbsp;Mar 4 2003 06:32:08 UTC</div></div><div class="card-body p-2"><pre style=white-space:pre-wrap>Okay. I&#39;ll just mark harpoon.dll as &#39;restartreplace&#39;, but to keep non-admin
users happy I will not require admin privileges. That means that these users may
be confronted with that weird message.

I cannot implement your workaround, the installer scripting is not that powerful...
</pre></div></div></div></div><div class="row pt-2"><div class=col-12><div class=card><div class="card-header h4 p-2"><div class=float-right>Comment 5</div><div class=float-left>Raymond Penners&nbsp;&nbsp;Mar 4 2003 10:17:01 UTC</div></div><div class="card-body p-2"><pre style=white-space:pre-wrap>I think I fixed this, but as I cannot always reproduce it, please test.

</pre></div></div></div></div><div class="row pt-2"><div class=col-12><div class=card><div class="card-header h4 p-2"><div class=float-right>Comment 6</div><div class=float-left>Raymond Penners&nbsp;&nbsp;Aug 19 2003 02:10:35 UTC</div></div><div class="card-body p-2"><pre style=white-space:pre-wrap>*** Bug 282 has been marked as a duplicate of this bug. ***</pre></div></div></div></div><div class="row pt-2"><div class=col-12><div class=card><div class="card-header h4 p-2"><div class=float-right>Comment 7</div><div class=float-left>Kees-Jan Dijkzeul&nbsp;&nbsp;Aug 19 2003 03:36:12 UTC</div></div><div class="card-body p-2"><pre style=white-space:pre-wrap>I get an access violation for harpoon.dll (see bug 282). As far as I know, I&#39;m
local administrator. Also, I do not get the error message mentioned in the
&#34;restartreplace&#34; explanation.

My best guess is that the installation process is not &#34;restartreplace&#34;-ing at
all, but instead attempting to delete the original harpoon.dll, while some
programs still have it open. Maybe other applications need some time to unload
harpoon.dll after wr has finished??</pre></div></div></div></div><div class="row pt-2"><div class=col-12><div class=card><div class="card-header h4 p-2"><div class=float-right>Comment 8</div><div class=float-left>Raymond Penners&nbsp;&nbsp;Aug 19 2003 16:33:35 UTC</div></div><div class="card-body p-2"><pre style=white-space:pre-wrap>The file harpoon.dll was processed twice by the installer, and the 2nd time it
did not have the restartreplace file toggled on.

Fixed.

Please give http://www.workrave.com/files/workrave-win32-1.4.0-test4.exe a try.
</pre></div></div></div></div><div class="row pb-5"></div></div></div><footer class="container bg-light page-footer"><div class="row my-2"><div class="col-12 col-md text-muted"><img src=/images/workrave-logo.svg alt=Workrave style=width:auto;height:20px>
<small class=d-block>&copy; 2001-2020 Raymond Penners & Rob Caelers</small></div><div class="col-12 col-md text-muted"><small>Unless otherwise stated, all text and images on this website are licensed
under the General Public License version 3 or later.<br>This website is powered by <a href=https://gohugo.io>Hugo</a></small></div></div></footer><script src=https://code.jquery.com/jquery-3.4.1.min.js integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js integrity=sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo crossorigin=anonymous></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js integrity=sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6 crossorigin=anonymous></script>
<script type=text/javascript src=https://workrave.org/js/main.min.428d5e8643be5482cc6cf2fb1c80b2e5625f8df018f53d6474a9f4d58668e74c58b35e455ed592b933e43659cc50dc11f452e947f61df3fd7b137161a785b411.js integrity="sha512-Qo1ehkO+VILMbPL7HICy5WJfjfAY9T1kdKn01YZo50xYs15FXtWSuTPkNlnMUNwR9FLpR/Yd8/17E3Fhp4W0EQ=="></script></body></html>